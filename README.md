# antimaks
Проект для парсинга сайтов по вебсокету
### Установка бота
Для начала необходимо установить на сервер подходящий дистрибутив linux с systemd, настоятельно рекомендуется ubuntu-server 24 lts (даллее инструкции для данного дистрибутива).

Скачиваем git (если не установлен):

```sudo apt-get install git```

Далее необходимо скопировать проект в папку пользователя.

```git clone https://github.com/califvladlen/antimaks.git```

теперь необходимо создать виртуальное окружение
```
cd antimaks
sudo apt install -y python3-venv
python3 -m venv myenv
source myenv/bin/activate
```

теперь необходимо установить библиотеки для работы бота.
```pip install -r requirements.txt```

### Настройка бота
для начала необходимо запустить бота в первый раз 
```python3 first_run.py```
после будут созданы файлы для настройки.
Приступим к их заполнению.
#####(Внимание! все инструкции ниже можно)
Откройте интересующую вас страницу в браузере, авторизируйтесь зайдите в любой чат. нажмите f12 и перезагрузите страницу. Теперь в появившемся окне откройте вкладку network. в данной вкладке в колонке name найдите строку websocket и откройте её. Во вкладке Headers скопируйте значение слева от Request URL. Откройте на сервере с ботом файл bot_settings.json в параметре "requests_domen": "тут" пропишите полученное значение.
В этом же файле пропишите токен для телеграм бота в параметре "token": "тут" (как его получить можете узнать погуглив)
Всё в том же файле необходимо прописать параметр "from_chat_id": "тут", его обычно можно получить зайдя в веб браузере в нужный чат и скопировав его id из строки с адресом сайта (обычно выглядит так: https://что-то.ru/нужное значение)

Заходим в телеграм, добавляем нашего бота в нужный чат, пишем /start. если бот ответил, значит всë ок. нажимаем Ctrl+z чтобы выключить бота. 
теперь перезапускаем сервер командой ```sudo reboot``` , прописываем пароль и сервер перезагружается. 

### Настройка systemd для авто перезапуска бота. 

Теперь бот может работать, но т.к. это запросы к API, вполне нормально возникновения ошибок, которые приводят к крашу бота. Так сферум АПИ может выкидывать бота +- раз в 15 минут. Дабы не перезапускать бота каждые 15 минут в ручную, мы создадим для этого "сервис", который будет делать это за нас, даже после перезагрузки сервера. 

для начала прописываем в терминале команду:
```sudo nano /etc/systemd/system/asbot.service```
вводим пароль администратора, и в открывшемся, уже знакомом нам редакторе пишем:
```
[Unit]
Description=My test service
After=multi-user.target

[Service]
User=имяпользователя
Group=имяпользователя
Type=simple
Environment=PYTHONPATH=/home/имяпользователя/antisferumbot
Restart=always
RestartSec=5s
ExecStart=результат_вывода_команды_pwd/myenv/bin/python3 результат_вывода_команды_pwd/main.py
[Install]
WantedBy=multi-user.target
```

после редактирования файла необходимо нажать ctrl+x, потом нажать y, после enter.

теперь необходимо выполнить следующие команды :

```
sudo systemctl daemon-reload
sudo systemctl enable asbot.service
sudo systemctl start asbot.service

```

если после ввода команд просит ввести пароль, вводим. 

теперь бот запущен и добавлен в автозагрузку, поверить это можно всë этой же командой /start в телеграмм чате с ботом. 

если же бот не запустился на данном этапе, проверить его состояние можно командой 
```
sudo systemctl status asbot.service
```
в случае неудачи будут выведены коды ошибок. 

##### По вопросам о проекте: https://t.me/wild_turtles или https://t.me/Dellnoz
